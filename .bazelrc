# FIXME: consider using RC files from guide: https://docs.aspect.build/guides/bazelrc/

## General rules
common --enable_platform_specific_config
common --incompatible_allow_tags_propagation
common --incompatible_use_plus_in_repo_names
test --test_output=errors
build --show_result=20
build --reuse_sandbox_directories
build --nolegacy_external_runfiles
build --noexperimental_check_output_files --experimental_allow_tags_propagation
fetch --noexperimental_check_output_files --experimental_allow_tags_propagation
query --noexperimental_check_output_files --experimental_allow_tags_propagation
build --nobuild_runfile_links
coverage --build_runfile_links

## JS

# passes an argument `--skipLibCheck` to *every* spawn of tsc
common --@aspect_rules_ts//ts:skipLibCheck=always
common --@aspect_rules_ts//ts:default_to_tsc_transpiler

# Allow the Bazel server to check directory sources for changes. Ensures that the Bazel server
# notices when a directory changes, if you have a directory listed in the srcs of some target.
# Recommended when using
# [copy_directory](https://github.com/aspect-build/bazel-lib/blob/main/docs/copy_directory.md) and
# [rules_js](https://github.com/aspect-build/rules_js) since npm package are source directories
# inputs to copy_directory actions.
# Docs: https://bazel.build/reference/command-line-reference#flag--host_jvm_args
startup --host_jvm_args=-DBAZEL_TRACK_SOURCE_DIRECTORIES=1

## GraalVM toolchain
build --extra_toolchains=@graalvm//:bootstrap_runtime_toolchain

## GraalVM versions
common --tool_java_runtime_version=graalvm_21
common --tool_java_language_version=21

common --java_runtime_version=graalvm_21
common --java_language_version=21

## Rust
startup --windows_enable_symlinks
build --enable_runfiles
build --@rules_rust//rust/toolchain/channel=nightly

## Allow local overrides of bazel configuration
try-import %workspace%/.bazelrc.local
